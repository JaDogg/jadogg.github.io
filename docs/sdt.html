<!doctypehtml><html lang="en"><meta charset="utf-8"><title>JaDogg&#x27;s Website</title><link rel="apple-touch-icon"sizes="180x180"href="/apple-touch-icon.png"><link rel="icon"type="image/png"sizes="32x32"href="/favicon-32x32.png"><link rel="icon"type="image/png"sizes="16x16"href="/favicon-16x16.png"><link rel="manifest"href="/site.webmanifest"><link rel="mask-icon"href="/safari-pinned-tab.svg"color="#5bbad5"><meta name="msapplication-TileColor"content="#da532c"><meta name="theme-color"content="#ffffff"><meta name="description"content="JaDogg&#x27;s Website"><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@200&display=swap"rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap"rel="stylesheet"><link rel="stylesheet"href="/assets/style.min.css"id="theme-link"><div class="container"><h1 class="center-text">JaDogg&#x27;s Website</h1><div class="table-of-contents"><p>Pages<nav><a href="/">Home</a></nav><button id="btn-toggle"class="button action-button">Let there be light</button><div>&nbsp;</div><p>Projects</p><a href="/yaksha.html">YakshaLang</a> | <a href="/sdt.html">SystemDesignToolkit</a> | <a href="/docbox.html">DocBox</a><div class="real-toc"><div>&nbsp;</div><p>Table of Content<div class="toc-item"><a href="#introduction">[1] Introduction</a></div><div class="toc-item"><a href="#usage-samples">[2] Usage Samples</a></div><div class="toc-item"><a href="#tinder-system-design">[2.1] Tinder System Design</a></div><div class="toc-item"><a href="#how-to-find-people-close-to-you">[2.1.1] How to find people close to you?</a></div><div class="toc-item"><a href="#quad-tree">[2.1.1.1] Quad Tree</a></div><div class="toc-item"><a href="#querying-nearby-people">[2.1.1.2] Querying nearby people</a></div><div class="toc-item"><a href="#geo-sharding">[2.1.1.3] Geo-sharding</a></div><div class="toc-item"><a href="#matching-and-likes">[2.1.1.4] Matching and likes</a></div><div class="toc-item"><a href="#rest-of-the-system">[2.1.2] Rest of the system</a></div><div class="toc-item"><a href="#authentication-and-security">[2.1.2.1] Authentication and security</a></div><div class="toc-item"><a href="#storing-images">[2.1.2.2] Storing images</a></div><div class="toc-item"><a href="#caches-and-power-law-distribution">[2.1.2.2.1] Caches and power law distribution</a></div><div class="toc-item"><a href="#image-formats">[2.1.2.2.2] Image formats</a></div><div class="toc-item"><a href="#bibliography">[2.1.2.3] Bibliography</a></div><div class="toc-item"><a href="#components">[3] Components</a></div><div class="toc-item"><a href="#services-and-related-components">[3.1] Services and related components</a></div><div class="toc-item"><a href="#service">[3.1.1] Service</a></div><div class="toc-item"><a href="#algorithms-and-data-structures">[3.2] Algorithms and data structures</a></div><div class="toc-item"><a href="#quad-tree">[3.2.1] Quad tree</a></div><div class="toc-item"><a href="#utilities">[3.3] Utilities</a></div><div class="toc-item"><a href="#pros-cons-box">[3.3.1] Pros-Cons Box</a></div></div></div><div class="boxes"><hr><div class="box"><div class="content"><div class="banner-image"><img alt="System Design Toolkit"src="images/system-design-tooklit-banner.png"style="max-width:100%"></div></div><div class="note"></div></div><div class="box"><div class="content"><h2 id="introduction">[1] Introduction</h2></div><div class="note"></div></div><div class="box"><div class="content"><p>I got an idea to come up with set of reusable (technology oblivious) building blocks for system design. Main point is you can either use it diagrams.net (or desktop version), whiteboard or any other tool you like. I use it myself and there's no reason for people other than me to use it. I'm designing this backwards from system design diagrams, so I will come up with multiple system designs and extract common components. Any form of constructive criticism is appreciated as usual.</div><div class="note"><p>ðŸ¤” Disagreeing for the sake of it is bad, cargo-culting is bad, somewhere middle is probably zen. - Me.</div></div><div class="box"><div class="content"><hr><h2 id="usage-samples">[2] Usage Samples</h2></div><div class="note"><hr></div></div><div class="box"><div class="content"><p>For usage examples I am planning on trying few system designs of well known software that anyone would be aware of. I'll be diving as deep as I think is necessary to explain my design here. By making myself come up with these designs I achieve two things. First of all I get to see what kind of common components are present in these system designs. I also get to publicly practice system design and expose myself to criticism.</div><div class="note"><p>Hopefully constructive criticism.</div></div><div class="box"><div class="content"><hr><h3 id="tinder-system-design">[2.1] Tinder System Design</h3></div><div class="note"><hr></div></div><div class="box"><div class="content"><a href="images/system-design-tinder.png"target="_blank"rel="noopener noreferrer"><img alt="Tinder Design, contain a diagram with arrows pointing to services"src="images/system-design-tinder.png"style="max-width:100%"></a></div><div class="note"><p>I'm up for suggestions. If you got an idea let me know.<p><span class="yellow-status">in progress</span></div></div><div class="box"><div class="content"><h4 id="how-to-find-people-close-to-you">[2.1.1] How to find people close to you?</h4><p>Main crux of this design is to find a suitable methodology to find people close to you.<ul><li><p>We can use Google S3 or Uber H3 - Both are ready-made libraries for this task.<li><p>We can use geo-hash prefix matching. This is a human-readable format, and you can easily look at two hashes and if they are closer based on the prefix.<li><p>Creating our own library - quad tree.</ul><h5 id="quad-tree">[2.1.1.1] Quad Tree</h5><p>This is an important data structure that we can use if we want to come up with this ourselves. Think of this as a structure that allows you to break down a square to four small squares, and you can keep going until it is very small. Internally it is a tree with 4 children.</p><img alt="3 Squares with quad-tree breakdown"src="images/sdt-quad-tree.png"style="max-width:100%"></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="querying-nearby-people">[2.1.1.2] Querying nearby people</h5><p>In above design we assumed that we use can find nearby users by simply looking at the profile database. However, we did not dive deep into what we need to ensure that we properly distribute profile data so we do not brown out a single node.</div><div class="note"></div></div><div class="box"><div class="content"><h5 id="geo-sharding">[2.1.1.3] Geo-sharding</h5><p>Geo sharding is a concept where we map roughly similar user count regions of the world in to different shards of the database. This is a load balancing mechanism and a way to avoid querying a lot of nodes and wasting time. As explained in Tinder blog posts they came up with shards by experimenting and finding out which amount of shards and how it was distributed resulted in good p50, p90 and p99 latency metrics. Example - London can be placed in one geo-shard while most of the Australian desert can also be placed in a single geo-shard. So the actual number of users would impact this rather than surface area on Earth.</div><div class="note"><p>Geo-sharding is a form of load balancing.</div></div><div class="box"><div class="content"><h5 id="matching-and-likes">[2.1.1.4] Matching and likes</h5><p>For this I'm thinking we can use a queue and set of serverless functions/lambdas to process incoming likes and write that to a database/cache. And we can use another set of lambdas to turn matches to notifications.</div><div class="note"><p>System that can spin up on-demand functions and distributed queues are (sub)systems of this system.</div></div><div class="box"><div class="content"><h4 id="rest-of-the-system">[2.1.2] Rest of the system</h4></div><div class="note"></div></div><div class="box"><div class="content"><h5 id="authentication-and-security">[2.1.2.1] Authentication and security</h5><p>For a secure system we need to consider <code>AAA</code> (Authentication , Authorization, and Accounting). However, there is no need to do implement a <code>RBAC</code> (Role-based access control) for end-users of the system. They will all be able to log-in to their own account and use the application. <code>RBAC</code> and full <code>AAA</code> is however important for internal teams and any admin applications used internally.<p>So from system design perspective something like eventual consistency does not make sense for passwords. Passwords themselves we cannot store in a database like you would with any other data.<ul><li><p>OWASP recommend <code>Argon2id</code> these days (<code>scrypt</code> and <code>PBKDF2-HMAC-SHA512</code> with <code>120k</code> iterations is also sufficient).<li><p>We can also use <code>peppering</code> for further security.<li><p>Another alternative is to sign in using email and never store any passwords.<li><p>It is also better to avoid coming up with own cryptographical algorithms.<li><p>It is perfectly fine to write it yourself for everything else. Having too many dependencies open yourself up to a lot of vulnerabilities.</ul><p>Getting back to why not eventual consistency, it is because if you change the password - It needs either successfully change everywhere or not change at all. This disallows a bad actor to luck into the system.</div><div class="note"><p>We can design authentication as a system as well.</div></div><div class="box"><div class="content"><h5 id="storing-images">[2.1.2.2] Storing images</h5><p>For a service such as Tinder images are essential. However, images are not required to find nearby users. It is however essential for users to see other users' images. Therefore, we can use on-disk storage for images and have a reference to it in our profile database. So when a user browse a profile we can get request these images on demand. It make sense to use a distributed file system.</div><div class="note"><p><code>DFS</code> (Distributed file system) is a (sub)system that we use in this system.</div></div><div class="box"><div class="content"><h6 id="caches-and-power-law-distribution">[2.1.2.2.1] Caches and power law distribution</h6><p>Caches or in this case specifically a <code>CDN</code> (Content delivery network) which is also another system on its own can help us scale with the load to access these user images. Let's think of celebrity situation, suddenly a recently divorced famous actor/actress creates a Tinder account. Now everyone wants to look at their images and swipe (whatever side for like). This is a good use-case for a <code>CDN</code> as these celebrity images are now cached.<p>Since the number of requests for an account is distributed in a power law distribution due to pareto principle. We can assume that the CDN can use a <code>LRU</code> (Least recently used) cache eviction mechanism. This way most recently used image will be kept hot in the cache.</div><div class="note"><p>Likes, Money and Followers this all work in a power law distribution, those who have more will always get more.</div></div><div class="box"><div class="content"><h6 id="image-formats">[2.1.2.2.2] Image formats</h6><p>Thumbnails for images is essential, and we can use a lossy data format such as JPG for thumbnails. Another good alternative is WebP. Also, PNGs can be used if we need any crisp images, but we can just use JPG for that as well.</div><div class="note"><p>Google's WebP format is support across most browsers and platforms these days.</div></div><div class="box"><div class="content"><h4 id="bibliography">[2.1.2.3] Bibliography</h4><details><summary>Bibliography for Tinder Design</summary><small><small><p>AAA (computer security). (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=AAA_(computer_security)&amp;oldid=1068643459 [Accessed 1 July 2022].<p>Designing Tinder - High Scalability -. (no date). Available from http://highscalability.com/blog/2022/1/17/designing-tinder.html [Accessed 1 July 2022].<p>Geometry on the Sphere: Google\x27s S2 Library. (no date). Available from https://docs.google.com/presentation/d/1Hl4KapfAENAOf4gv-pSngKwvS_jwNVHRPZTTDzXXn6Q [Accessed 1 July 2022].<p>GKQuadtree | Apple Developer Documentation. (no date). Available from https://developer.apple.com/documentation/gameplaykit/gkquadtree [Accessed 1 July 2022].<p>Li, X. (2019). Geosharded Recommendations Part 2: Architecture. Tinder Tech Blog. Available from https://medium.com/tinder/geosharded-recommendations-part-2-architecture-3396a8a7efb [Accessed 1 July 2022].<p>Pareto principle. (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=Pareto_principle&amp;oldid=1095743858 [Accessed 1 July 2022].<p>Password Storage - OWASP Cheat Sheet Series. (no date). Available from https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#pbkdf2 [Accessed 1 July 2022].<p>Passwordless authentication. (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=Passwordless_authentication&amp;oldid=1082243741 [Accessed 1 July 2022].<p>Power law. (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=Power_law&amp;oldid=1091370904 [Accessed 1 July 2022].<p>Ren, F. (2019). Geosharded Recommendations Part 1: Sharding Approach. Tinder Tech Blog. Available from https://medium.com/tinder/geosharded-recommendations-part-1-sharding-approach-d5d54e0ec77a [Accessed 1 July 2022].<p>Role-based access control. (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=Role-based_access_control&amp;oldid=1094481919 [Accessed 1 July 2022].<p>S2 Geometry. (no date). S2Geometry. Available from http://s2geometry.io/ [Accessed 1 July 2022].<p>Thomson, D. (2019). Geosharded Recommendations Part 3: Consistency. Tinder Tech Blog. Available from https://medium.com/tinder/geosharded-recommendations-part-3-consistency-2d2cb2f0594b [Accessed 1 July 2022].<p>Tran, J. (2019). Which Image Format for Making Smaller File Size? GretaThemes. Available from https://gretathemes.com/image-format-for-smaller-file-size/ [Accessed 1 July 2022].<p>UV mapping. (2022). Wikipedia. Available from https://en.wikipedia.org/w/index.php?title=UV_mapping&amp;oldid=1094514074 [Accessed 1 July 2022].<p>WebP Compression Study. (no date). Google Developers. Available from https://developers.google.com/speed/webp/docs/webp_study [Accessed 1 July 2022].<p>What is a Quadtree &amp; how is it used in location-based services? (no date). Available from https://www.educative.io/answers/what-is-a-quadtree-how-is-it-used-in-location-based-services [Accessed 1 July 2022].<p>Whited, S. (no date). Best practices for password hashing and storage. Internet Engineering Task Force. Available from https://datatracker.ietf.org/doc/draft-ietf-kitten-password-storage-04 [Accessed 1 July 2022].</small></small></details></div><div class="note"></div></div><div class="box"><div class="content"><hr><h2 id="components">[3] Components</h2></div><div class="note"><hr></div></div><div class="box"><div class="content"><h3 id="services-and-related-components">[3.1] Services and related components</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="service">[3.1.1] Service</h4><img alt="Three squares on top of each other with service written in the middle"src="images/sdt-service.png"style="max-width:100%"><p>This is used for microservice components. Reason why I put multiple boxes here is to indicate that there are more than one service instance running.<p>Load balancing for this service is assumed to be dealt with. I do not think there's a reason to draw load balancers, but you can draw it if you wish.</div><div class="note"><p>This is different from function/lambda component.</div></div><div class="box"><div class="content"><h3 id="algorithms-and-data-structures">[3.2] Algorithms and data structures</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="quad-tree">[3.2.1] Quad tree</h4><img alt="3 Squares with quad-tree breakdown"src="images/sdt-quad-tree.png"style="max-width:100%"><p>Quad tree allows you to map a section to four subsections. One good use case is mapping a geographical area.</div><div class="note"></div></div><div class="box"><div class="content"><h3 id="utilities">[3.3] Utilities</h3></div><div class="note"></div></div><div class="box"><div class="content"><h4 id="pros-cons-box">[3.3.1] Pros-Cons Box</h4><img alt="Table with pros and cons specified as titles"src="images/sdt-pro-con.png"style="max-width:100%"><p>This is rather simple table to list pros and cons. Use it when you want to compare different technologies of decisions.</div><div class="note"><p>Pro - it got pros. Con - it got cons.</div></div></div></div><script>!function(){const e=document.querySelector("#btn-toggle"),s=document.querySelector("#theme-link"),t="jadogg.github.io/theme",n="Let there be light",i="I thrive in darkness";var l=localStorage.getItem(t);"/assets/style.min.css"!==l&&"/assets/style.light.min.css"!==l||(s.href=l,e.innerHTML="/assets/style.min.css"===l?n:i),e.addEventListener("click",function(){"/assets/style.min.css"===s.getAttribute("href")?(s.href="/assets/style.light.min.css",localStorage.setItem(t,"/assets/style.light.min.css"),e.innerHTML=i):(s.href="/assets/style.min.css",localStorage.setItem(t,"/assets/style.min.css"),e.innerHTML=n)})}()</script>